from flask import Flask, request, jsonify
import redis

app = Flask(__name__)
r = redis.Redis(host='localhost', port=6379)

@app.route('/redeem', methods=['POST'])
def redeem():
    token = request.json.get('token')
    if r.get(token) == b'used':
        return jsonify({'error': 'Token already used'}), 403
    # İşlem yap (örneğin, içerik göster)
    r.set(token, 'used', ex=300)  # 5 dakika TTL
    return jsonify({'success': 'Redeemed'})

if __name__ == '__main__':
    app.run()
    